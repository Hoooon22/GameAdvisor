# GameAdvisor

게임 화면 위에서 활동하는 AI 어드바이저 캐릭터가 실시간으로 도움을 제공하는 프로그램

## 🎮 주요 특징

- **인터랙티브 캐릭터**: 마우스로 잡아서 날릴 수 있는 물리 효과가 적용된 어드바이저 캐릭터
- **완전 투명 오버레이**: 게임 플레이를 방해하지 않는 100% 투명한 오버레이 시스템
- **물리 시뮬레이션**: 중력, 충돌, 마찰력이 적용된 실감나는 캐릭터 물리 효과
- **스마트 애니메이션**: 드래그, 날아가기, 충돌, 기절 등 다양한 상황별 애니메이션
- **말풍선 상호작용**: 다양한 스타일의 말풍선으로 조언과 정보 제공
- **말풍선 관리 시스템**: 최소화/복원 기능과 X 버튼으로 사용자 제어 가능
- **클릭 회피 시스템**: 사용자가 클릭하는 위치를 피해 움직이는 스마트 캐릭터
- **AI + 웹 검색 통합**: Gemini AI와 웹 검색 결과를 결합한 더 정확한 공략 분석
- **게임별 맞춤 조언**: 각 게임에 특화된 개인화된 조언 시스템
- **실시간 게임 감지**: Windows API를 활용한 자동 게임 감지 및 추적

## 프로젝트 구조

```
GameAdvisor/
├── backend/                # Spring Boot 백엔드 서버
│   ├── src/               # 소스 코드
│   ├── build.gradle       # Gradle 빌드 설정
│   └── README.md          # 백엔드 문서
│
└── client/                # JavaFX 클라이언트
    ├── src/
    │   └── main/java/com/gameadvisor/client/
    │       ├── ui/
    │       │   ├── GameAdvisorClient.java      # 메인 클라이언트
    │       │   └── components/
    │       │       ├── AdvisorCharacter.java   # 캐릭터 컴포넌트
    │       │       ├── SpeechBubble.java       # 말풍선 컴포넌트
    │       │       └── CharacterOverlay.java   # 오버레이 관리
    │       ├── model/                          # 데이터 모델
    │       ├── network/                        # API 통신
    │       ├── service/                        # 게임 감지 서비스
    │       └── util/                           # Windows API 유틸
    ├── build.gradle      # Gradle 빌드 설정
    └── README.md         # 클라이언트 문서
```

## 기술 스택

### Backend
- Java 17
- Spring Boot 3.5.0
- Gradle
- Spring Data JPA
- MySQL 8.0

### Client
- Java 17
- JavaFX 17
- Gradle
- JNA (Java Native Access) - Windows API 연동

## 🚀 시작하기

### 요구사항
- JDK 17 이상
- Gradle 8.x
- MySQL 8.0 이상
- Windows 10/11 (현재 Windows만 지원)

### 실행 방법

1. **백엔드 서버 실행**
```bash
cd backend
./gradlew bootrun
```

2. **클라이언트 실행**
```bash
cd client
./gradlew run
```

3. **웹 자료 학습 실행** 🆕
```bash
# 모든 BTD 관련 웹 자료 수집 및 학습
.\start-web-learning.ps1 -Mode all

# 특정 주제 자료 수집
.\start-web-learning.ps1 -Mode topic -Topic "ceramic defense"

# 키워드로 자료 수집
.\start-web-learning.ps1 -Mode keyword -Keyword "MOAB"

# 서비스 상태 확인
.\start-web-learning.ps1 -Mode status

# 벡터 DB 구축 (최초 1회)
.\setup-btd-vector-db.ps1

# 웹 크롤링 테스트
.\test-web-crawl.ps1
```

4. **벡터 DB 구축** 🆕
```bash
# BTD 벡터 DB 구축 가이드 참조
# 자세한 내용은 BTD_벡터DB_구축_가이드.md 참조
.\setup-btd-vector-db.ps1 -Depth 2 -MaxPages 100
```

**실행 순서**:
1. 먼저 백엔드 서버를 실행하여 API 서버를 구동
2. 백엔드가 완전히 시작된 후 클라이언트를 실행
3. 클라이언트는 게임을 자동으로 탐지하여 캐릭터를 표시
4. 필요시 웹 학습 스크립트로 최신 공략 정보를 벡터 DB에 학습

## 🎮 사용법

### 기본 인터랙션
1. **게임 실행**: 지원되는 게임을 실행하면 캐릭터가 게임 화면 하단에 자동으로 나타남
2. **자동 활동**: 캐릭터가 10초마다 자동으로 걷거나 말풍선으로 조언 제공
3. **게임별 조언**: 각 게임에 맞는 특화된 팁과 조언을 말풍선으로 표시
4. **AI 화면 분석**: 캐릭터 오른쪽 위 🔍 버튼 클릭으로 현재 게임 화면을 AI가 분석하여 조언 제공

### 물리 인터랙션
1. **캐릭터 드래그**: 캐릭터를 마우스 왼쪽 버튼으로 클릭하고 드래그
2. **투사하기**: 원하는 방향과 거리만큼 드래그한 후 마우스 버튼을 놓으면 캐릭터가 날아감
3. **물리 효과**: 중력에 의해 떨어지고, 벽과 바닥에 충돌하며 현실적인 반응
4. **자동 복구**: 물리 효과가 끝나면 기절 상태를 거쳐 정상 상태로 복귀

### 애니메이션 상태
- **IDLE**: 평상시 서 있는 상태 (호흡 애니메이션)
- **WALKING**: 게임 창 내에서 걸어다니는 상태
- **TALKING**: 말풍선과 함께 대화하는 상태
- **THINKING**: 머리를 흔들며 생각하는 상태
- **DRAGGING**: 드래그되고 있는 상태 (크기 증가, 회전)
- **FLYING**: 공중에서 날아가는 상태
- **STUNNED**: 충돌 후 기절한 상태 (X자 눈, 흔들림)

### 말풍선 관리 기능
1. **X 버튼**: 공략 조언 말풍선의 오른쪽 위 빨간색 X 버튼으로 수동 닫기
2. **최소화 버튼**: 초록색 "-" 버튼으로 말풍선을 작업표시줄처럼 최소화
3. **복원 기능**: 최소화된 바를 클릭하여 다시 말풍선 복원
4. **부드러운 전환**: 200ms 페이드 애니메이션으로 자연스러운 전환 효과

### 클릭 회피 시스템
1. **클릭 감지**: 게임 화면 내 사용자 클릭 위치 실시간 감지
2. **회피 움직임**: 클릭 위치에서 150px 거리만큼 반대 방향으로 이동
3. **시간 제한**: 클릭 후 3초간 회피 효과 지속
4. **랜덤 요소**: 완전히 예측 가능하지 않은 자연스러운 회피 패턴

### 팁
- 캐릭터를 멀리 드래그할수록 더 빠르게 날아갑니다
- 물리 효과 중에는 자동 활동이 일시정지됩니다
- 게임 창 경계 밖으로는 나가지 않습니다
- 더블클릭으로 테스트 물리 효과를 실행할 수 있습니다
- 🔍 버튼을 클릭하면 AI가 현재 게임 상황을 분석하여 맞춤 조언을 제공합니다
- 공략 조언은 자동으로 사라지지 않아 천천히 읽을 수 있습니다
- X 버튼으로 공략 조언을 닫거나 "-" 버튼으로 최소화할 수 있습니다
- 캐릭터가 클릭하는 위치를 피해 움직여 게임 플레이를 방해하지 않습니다
- 말풍선 표시 시간은 텍스트 길이에 따라 자동으로 조절됩니다 (2-12초)

## 🎯 주요 기능

### 1. 물리 기반 캐릭터 인터랙션
- **마우스 드래그**: 캐릭터를 마우스로 잡아서 드래그할 수 있음
- **투사 물리**: 드래그 거리와 방향에 따라 캐릭터를 날릴 수 있음
- **실시간 물리**: 중력(400px/s²), 공기마찰력(0.995), 바운스 감쇠(0.75) 적용
- **벽면 충돌**: 게임 창 경계와의 충돌 시 현실적인 반발 효과
- **바닥 충돌**: 바닥 충돌 시 랜덤 효과와 점진적 정지

### 2. 다이나믹 애니메이션 시스템
- **서있기 (IDLE)**: 자연스러운 호흡 애니메이션
- **걷기 (WALKING)**: 팔다리 움직임이 있는 보행 애니메이션
- **말하기 (TALKING)**: 눈 깜빡임과 함께하는 대화 애니메이션
- **생각하기 (THINKING)**: 머리를 좌우로 흔드는 사고 애니메이션
- **드래그 중 (DRAGGING)**: 팔다리가 벌어지고 눈이 커지는 효과
- **날아가는 중 (FLYING)**: 팔다리를 펼친 상태로 날아가는 애니메이션
- **기절 (STUNNED)**: X자 눈과 흔들림 효과가 있는 기절 상태

### 3. 충돌 효과 시스템
- **시각적 피드백**: 충돌 시 색상 변화 (주황→노랑→원래색)
- **진동 효과**: 충돌 강도에 따른 캐릭터 진동
- **쿨다운 시스템**: 과도한 충돌 효과 방지 (200ms 간격)
- **물리 완료 후 안정화**: 3초 쿨다운으로 위치 강제 재설정 방지

### 4. AI 화면 분석 + 웹 검색 통합 시스템
- **Gemini Vision API**: Google의 최신 AI 모델로 게임 화면을 실시간 분석
- **웹 검색 통합**: AI 분석과 함께 최신 공략 정보를 웹에서 검색하여 종합 분석
- **하이브리드 분석**: AI의 시각적 분석 + 웹 검색의 최신 정보를 결합한 더 정확한 조언
- **화면 캡쳐**: 게임 창 영역만 정확히 캡쳐하여 AI에게 전송
- **상황별 조언**: 현재 게임 상황에 맞는 구체적이고 전략적인 조언 제공
- **비동기 처리**: 백그라운드에서 분석하여 게임 플레이 중단 없음
- **원클릭 분석**: 캐릭터 옆 🔍 버튼으로 간편하게 분석 요청

### 5. 스마트 말풍선 시스템
- **다양한 스타일**: 일반 대화, 조언, 경고, 성공, 생각, 공략 등 6가지 스타일
- **말풍선 제어**: X 버튼(닫기), 최소화 버튼(접기/펴기) 지원
- **윈도우 스타일 최소화**: 작업표시줄과 같은 "📋 공략 조언" 바로 최소화
- **200ms 애니메이션**: 부드러운 페이드 인/아웃으로 자연스러운 전환 효과
- **동적 위치 조정**: 화면 경계를 고려한 똑똑한 말풍선 위치 자동 조정
- **캐릭터를 따라다니는 동적 위치 조정** (물리 효과 중에도 추적)
- **반투명 배경**(90% 불투명도)으로 모든 게임 화면에서 선명한 가독성
- **텍스트 길이에 따른 적응형 표시 시간** (2-12초 자동 조절)
- **표시 중 캐릭터 자동 활동 일시정지**로 중단 없는 읽기 경험

### 6. 클릭 회피 움직임 시스템
- **실시간 클릭 감지**: 게임 오버레이 전체에서 사용자 클릭 위치 추적
- **스마트 회피**: 클릭 위치에서 150px 거리만큼 반대 방향으로 이동
- **시간 기반 회피**: 클릭 후 3초간 회피 효과 지속으로 충분한 회피 시간 제공
- **기존 랜덤 움직임 제거**: 목적 없는 랜덤 움직임을 제거하고 사용자 중심 움직임으로 전환
- **게임 플레이 방해 최소화**: 사용자가 클릭하려는 위치를 능동적으로 피해 게임 경험 향상

### 7. 게임별 맞춤 조언
- 각 게임에 특화된 개인화된 조언 시스템
- 이모지를 활용한 친근한 메시지
- 10초마다 자동으로 다양한 활동 수행 (물리 모드 중에는 정지)
- 웹 검색 결과와 AI 분석을 결합한 더 정확하고 최신화된 공략 정보

### 8. 웹 자료 수집 및 학습 시스템 🆕
- **인터넷 자료 자동 수집**: BTD 관련 웹사이트에서 최신 공략 정보 자동 수집
- **신뢰할 수 있는 소스**: Reddit, Fandom, GamePress 등 검증된 사이트만 선별 수집
- **AI 텍스트 처리**: JSoup을 활용한 웹 페이지 파싱 및 BTD 관련 내용 필터링
- **벡터 DB 자동 학습**: 수집된 자료를 임베딩하여 벡터 데이터베이스에 자동 저장
- **주제별 맞춤 수집**: 세라믹 방어, MOAB 전략, 카모 탐지 등 특정 주제 집중 수집
- **키워드 기반 검색**: 사용자 지정 키워드로 실시간 자료 수집 및 학습
- **백그라운드 처리**: 게임 플레이를 방해하지 않는 비동기 자료 수집
- **PowerShell 스크립트 지원**: 간편한 명령어로 웹 학습 기능 실행

### 9. 투명 오버레이 기술
- 완전히 투명한 배경으로 게임 플레이 방해 없음
- 마우스 클릭 이벤트가 게임으로 통과 (캐릭터는 클릭 가능)
- 게임 창 위에 항상 표시되는 스마트 레이어링

### 10. 이중 창 시스템
- **상태창**: 게임 탐지 전 표시되는 작은 정보창
- **오버레이창**: 게임 탐지 시 전체 화면을 덮는 투명창
- 자동 전환으로 수동 조작 불필요

## 🔧 시스템 아키텍처

### 게임 감지 시스템
- Windows Process API를 통한 실시간 프로세스 감지
- 게임 창 위치 및 크기 실시간 추적
- 최소화/복원 상태 자동 감지

### 오버레이 렌더링
- JavaFX Stage의 TRANSPARENT 스타일 활용
- 마우스 이벤트 통과를 위한 setPickOnBounds(false) 설정
- 항상 위에 표시를 위한 setAlwaysOnTop(true) 적용

### 캐릭터 애니메이션
- Timeline 기반 부드러운 애니메이션 시스템
- 상태 기반 애니메이션 전환 (IDLE, WALKING, TALKING, THINKING)
- 게임 창 경계 내에서만 활동하는 제한된 이동

## 📊 개발 진행상황

### ✅ 완료된 기능
- **백엔드**: Spring Boot 기반 게임 정보 API 서버
- **게임 감지**: Windows API를 활용한 실시간 게임 프로세스 감지
- **캐릭터 시스템**: 완전한 캐릭터 기반 UI 구현
- **투명 오버레이**: 100% 투명한 게임 위 오버레이 시스템
- **말풍선 시스템**: 6가지 스타일의 동적 말풍선 (반투명 배경, 적응형 표시 시간)
- **말풍선 관리**: X 버튼과 최소화/복원 기능으로 완전한 사용자 제어
- **클릭 회피 시스템**: 사용자 클릭을 감지하고 피하는 스마트 캐릭터 움직임
- **애니메이션**: 부드러운 캐릭터 움직임 및 상태 전환
- **이중 창 관리**: 상태창과 오버레이창의 스마트 전환
- **물리 시뮬레이션**: 중력, 충돌, 마찰력이 적용된 실시간 물리 효과
- **마우스 인터랙션**: 드래그 앤 드롭으로 캐릭터를 조작하는 인터랙티브 시스템
- **충돌 효과**: 벽면/바닥 충돌 시 시각적 피드백과 애니메이션
- **AI + 웹 검색 통합**: Gemini Vision API와 웹 검색을 결합한 하이브리드 분석 시스템
- **화면 캡쳐**: 게임 창 영역만 정확히 캡쳐하는 스크린샷 시스템
- **인터랙션 제어**: 말풍선 표시 중 캐릭터 자동 활동 일시 정지

### 🚧 개발 중인 기능
- 더 많은 게임 지원 추가
- 캐릭터 커스터마이징 옵션
- 음성 안내 기능
- 게임별 고급 분석 기능
- 캐릭터 감정 표현 시스템
- 멀티플레이어 게임 지원

### 📅 최근 업데이트 (2025-01-15)

#### 🌐 웹 자료 수집 및 자동 학습 시스템 구축 🆕
- **WebDataCollectionService**: 인터넷에서 BTD 관련 자료를 자동으로 수집하는 핵심 서비스
- **신뢰할 수 있는 소스**: Reddit, Fandom, GamePress 등 검증된 웹사이트만 선별하여 자료 수집
- **JSoup 웹 파싱**: HTML 페이지에서 BTD 관련 내용만 정확히 추출하는 지능형 파싱 시스템
- **벡터 DB 자동 학습**: 수집된 텍스트를 임베딩하여 벡터 데이터베이스에 자동 저장
- **WebLearningController**: REST API로 웹 학습 기능을 제어하는 사용자 친화적 인터페이스
- **주제별/키워드별 수집**: 사용자가 원하는 특정 주제나 키워드로 맞춤형 자료 수집
- **백그라운드 처리**: 게임 플레이를 방해하지 않는 비동기 자료 수집 및 학습
- **PowerShell 자동화**: start-web-learning.ps1 스크립트로 간편한 웹 학습 실행

#### 📊 웹 학습 API 엔드포인트
- **POST /api/web-learning/collect-all**: 모든 BTD 관련 웹 자료를 종합적으로 수집
- **POST /api/web-learning/collect-topic**: 특정 주제에 대한 맞춤형 자료 수집
- **POST /api/web-learning/collect-keyword**: 키워드 기반 실시간 자료 수집
- **GET /api/web-learning/status**: 웹 학습 서비스 상태 및 추천 주제 확인
- **GET /api/web-learning/help**: 사용 가능한 모든 API 기능 안내

#### 🛠️ PowerShell 스크립트 가이드
- **start-web-learning.ps1**: 웹 학습 기능을 실행하는 메인 스크립트
  - `-Mode all`: 모든 BTD 관련 자료 수집
  - `-Mode topic -Topic "주제명"`: 특정 주제 집중 수집
  - `-Mode keyword -Keyword "키워드"`: 키워드 기반 수집
  - `-Mode status`: 서비스 상태 확인
- **setup-btd-vector-db.ps1**: BTD 벡터 DB 구축 스크립트
  - `-Depth 숫자`: 크롤링 깊이 설정 (기본: 2)
  - `-MaxPages 숫자`: 최대 수집 페이지 수 (기본: 100)
- **test-web-crawl.ps1**: 웹 크롤링 기능 테스트 스크립트

#### 📚 벡터 데이터베이스 구조
- **BloonsTDKnowledge**: BTD 관련 지식 저장 모델
- **BTDVectorController**: 벡터 DB 관리 API 컨트롤러
- **WebDataCollectionService**: 웹 자료 수집 핵심 서비스
- **BTDAdvancedDataService**: 고급 BTD 데이터 처리 서비스

### 📅 이전 업데이트 (2025-07-02)

#### 🎛️ 말풍선 사용자 제어 시스템 구축
- **X 버튼 개선**: 공략 조언 말풍선에 28x28 크기의 빨간색 X 버튼 추가
- **최소화/복원 기능**: 윈도우 스타일의 초록색 "-" 버튼으로 말풍선을 작업표시줄처럼 최소화
- **최소화 바**: "📋 공략 조언" 라벨이 있는 미니멀한 바로 표시
- **부드러운 애니메이션**: 200ms 페이드 인/아웃으로 자연스러운 전환 효과
- **사용자 제어**: 공략 조언이 자동으로 사라지지 않아 원하는 만큼 읽을 수 있음
- **콜백 시스템**: CharacterOverlay와 SpeechBubble 간 효율적인 상태 관리

#### 🎯 클릭 회피 움직임 시스템 도입
- **실시간 클릭 감지**: 게임 오버레이 전체에서 사용자 클릭 위치 추적
- **스마트 회피**: 클릭 위치에서 150px 거리만큼 반대 방향으로 이동
- **시간 기반 회피**: 클릭 후 3초간 회피 효과 지속으로 충분한 회피 시간 제공
- **기존 랜덤 움직임 제거**: 목적 없는 랜덤 움직임을 제거하고 사용자 중심 움직임으로 전환
- **게임 플레이 방해 최소화**: 사용자가 클릭하려는 위치를 능동적으로 피해 게임 경험 향상

#### 🔍 AI + 웹 검색 하이브리드 분석 시스템
- **웹 검색 통합**: GeminiService에 WebSearchService를 통합하여 더 정확한 분석
- **하이브리드 프롬프트**: AI 시각 분석과 웹 검색 결과를 결합한 종합적 분석 요청
- **최신 정보 반영**: 웹 검색으로 최신 공략 정보와 메타 변화를 실시간 반영
- **향상된 정확도**: 단순 시각 분석을 넘어 검증된 공략 정보 기반 조언 제공
- **게임별 검색 최적화**: 각 게임에 특화된 검색 키워드로 관련도 높은 정보 수집

#### 🎨 말풍선 위치 조정 시스템 개선
- **화면 경계 인식**: 말풍선이 화면 위쪽으로 잘리는 문제 해결
- **똑똑한 위치 조정**: 위쪽 공간 부족 시 자동으로 아래쪽이나 옆쪽으로 이동
- **텍스트 영역 확장**: 최대 너비 280px, 최대 높이 200px로 긴 텍스트 지원
- **꼬리 위치 적응**: 말풍선 위치에 따라 꼬리(화살표)도 적절한 위치로 조정
- **매개변수 최적화**: positionAboveCharacter() 메서드에 화면 경계 정보 전달

#### 🤖 AI 화면 분석 시스템 지속 개선
- **Gemini Vision API 연동**: Google의 최신 AI 모델을 활용한 실시간 게임 화면 분석
- **화면 캡쳐 유틸리티**: Java Robot 클래스 기반으로 게임 창 영역만 정확히 캡쳐하는 시스템 구현
- **인터랙티브 분석 버튼**: 캐릭터 오른쪽 위에 🔍 버튼 추가로 언제든지 화면 분석 요청 가능
- **Base64 이미지 처리**: 캡쳐된 화면을 Base64로 인코딩하여 API 서버로 안전하게 전송
- **비동기 분석 처리**: 백그라운드 Task로 화면 분석을 수행하여 게임 플레이 중단 없음

#### 🎨 말풍선 UI/UX 지속 혁신
- **반투명 배경 적용**: 말풍선 배경을 90% 불투명도로 설정하여 게임 화면 위에서도 선명한 가독성 확보
- **텍스트 가독성 강화**: 흰색 텍스트에 검은색 드롭 셰도우 추가로 모든 배경에서 명확히 식별 가능
- **적응형 표시 시간**: 텍스트 길이에 따라 2초~12초 사이에서 자동 조절되는 스마트 타이밍 시스템
- **인터랙션 중단 기능**: 말풍선 표시 중에는 캐릭터의 자동 활동과 위치 업데이트를 일시 정지
- **95% 투명도 애니메이션**: 페이드 인/아웃 시 적절한 투명도로 자연스러운 전환 효과

#### 🔧 백엔드 API 확장
- **화면 분석 엔드포인트**: `/api/advice/screen` POST API로 이미지 기반 게임 상황 분석
- **웹 검색 API**: WebSearchService로 실시간 공략 정보 검색 기능
- **ScreenAnalysisRequest/Response 모델**: 구조화된 요청/응답 모델로 안정적인 데이터 교환
- **Jackson 직렬화 최적화**: LocalDateTime을 String으로 변환하여 클라이언트 호환성 확보
- **타임아웃 확장**: AI 분석을 위한 API 호출 타임아웃을 60초로 확장

#### 🎮 게임별 맞춤 분석
- **Master Duel 특화**: Yu-Gi-Oh! 게임 상황을 정확히 파악하고 전략적 조언 제공
- **실시간 상황 인식**: 듀얼 단계, 카드 상태, 전장 상황을 AI가 종합적으로 분석
- **전략적 조언**: 게임 상황에 맞는 구체적이고 실용적인 플레이 가이드 제공
- **친근한 UI**: 이모지와 자연스러운 한국어로 사용자 친화적인 조언 전달

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'feat: Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📝 Git 커밋 메시지 규칙

- `feat`: 새로운 기능 추가
- `fix`: 버그 수정
- `docs`: 문서 수정
- `style`: 코드 포맷팅, 세미콜론 누락 등
- `refactor`: 코드 리팩토링
- `test`: 테스트 코드 추가
- `chore`: 빌드 업무 수정, 패키지 매니저 수정

## 📄 라이선스

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details

## 🙏 개발 가이드

자세한 개발 가이드는 각 모듈의 README.md를 참고해주세요:
- [Backend 개발 가이드](backend/README.md)
- [Client 개발 가이드](client/README.md)